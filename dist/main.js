(()=>{"use strict";var e={405:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var a=s(286),r=s(352);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function n(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,i(a.key),a)}}function i(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,"string");if("object"!=o(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:String(t)}t.Component=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,s;return t=e,(s=[{key:"setState",value:function(e){if(null==this.mountedElement)throw new Error("you are updating an unmounted component");this.state=e(this.state),(0,r.applyUpdate)(this.mountedElement,this.getUpdateDiff())}},{key:"setProps",value:function(e){if(null==this.mountedElement)throw new Error("You are setting the props of an inmounted component");return this.state=this.componentWillRecieveProps(e,this.state),this.props=e,this.getUpdateDiff()}},{key:"initProps",value:function(e){return this.props=e,this.currentRootNode=this.render(),this.currentRootNode}},{key:"getUpdateDiff",value:function(){var e=this,t=this.render(),s=(0,a.createDiff)(this.currentRootNode,t);return"replace"==s.kind&&(s.callback=function(t){return e.mountedElement=t}),this.currentRootNode=t,setTimeout((function(){return e.componentDidUpdate()})),s}},{key:"notifyMounted",value:function(e){var t=this;this.mountedElement=e,setTimeout((function(){return t.componentDidMount()}))}},{key:"unmount",value:function(){this.componentWillUnmount(),this.mountedElement=null}},{key:"componentDidMount",value:function(){}},{key:"componentWillRecieveProps",value:function(e,t){return t}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillUnmount",value:function(){}}])&&n(t.prototype,s),Object.defineProperty(t,"prototype",{writable:!1}),e}()},286:(e,t)=>{function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var s=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=s){var a,r,o,n,i=[],c=!0,l=!1;try{if(o=(s=s.call(e)).next,0===t){if(Object(s)!==s)return;c=!1}else for(;!(c=(a=o.call(s)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=s.return&&(n=s.return(),Object(n)!==n))return}finally{if(l)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?r(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function o(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function n(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?o(Object(s),!0).forEach((function(t){i(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):o(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function i(e,t,a){var r;return r=function(e,t){if("object"!=s(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,"string");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==s(r)?r:String(r))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0}),t.createDiff=void 0;var c=function(e){return{kind:"replace",newNode:e}},l=t.createDiff=function(e,t){return"text"==e.kind&&"text"==t.kind&&e.value==t.value?{kind:"skip"}:"text"==e.kind||"text"==t.kind?c(t):"component"==e.kind&&"component"==t.kind&&e.component==t.component&&e.instance?(t.instance=e.instance,e.props,t.props,t.instance.setProps(t.props)):"component"==e.kind?(e.instance.unmount(),e.instance=null,c(t)):"component"==t.kind?(t.instance=new t.component,{kind:"replace",newNode:t.instance.initProps(t.props),callback:function(e){return t.instance.notifyMounted(e)}}):e.tagname!=t.tagname?c(t):{kind:"update",attributes:{remove:Object.keys(e.props||{}).filter((function(e){return-1==Object.keys(t).indexOf(e)})),set:Object.keys(t.props||{}).filter((function(s){return e.props[s]!=t.props[s]})).reduce((function(e,s){return n(n({},e),{},i({},s,t.props[s]))}),{})},childeren:p(e.childeren||[],t.childeren||[])}},d=function(e,t,s){for(;t[0]&&t[0][0]!=s;)"component"==t[0][1].kind&&(t[0][1].instance.unmount(),t[0][1].instance=null),e.push({kind:"remove"}),t.shift()},h=function(e,t,s){for(;t[0]&&t[0][0]!=s;)e.push({kind:"insert",node:t.shift()[1]})},p=function(e,t){for(var s=e.map((function(e){return[e.key,e]})),r=t.map((function(e){return[e.key,e]})),o=[],n=a(s.find((function(e){return-1!=r.map((function(e){return e[0]})).indexOf(e[0])}))||[null],1)[0];n;)d(o,s,n),h(o,r,n),o.push(l(s.shift()[1],r.shift()[1])),n=a(s.find((function(e){return-1!=r.map((function(e){return e[0]})).indexOf(e[0])}))||[null],1)[0];return d(o,s,void 0),h(o,r,void 0),o}},582:(e,t,s)=>{t.Q=void 0;var a=s(405),r=s(578);t.Q={createElement:r.createElement,createText:r.createText,createComponent:r.createComponent,Component:a.Component}},352:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderDOM=t.applyUpdate=void 0;var s=function e(t){if("text"==t.kind)return document.createTextNode(t.value);if("component"==t.kind){if(t.instance){var s=e(t.instance.render());return t.instance.notifyMounted(s),s}t.instance=new t.component;var a=e(t.instance.initProps(t.props));return t.instance.notifyMounted(a),a}var r=document.createElement(t.tagname);for(var o in t.props||{})r[o]=t.props[o];return(t.childeren||[]).forEach((function(t){return r.appendChild(e(t))})),r},a=t.applyUpdate=function(e,t){if("skip"==t.kind)return e;if("replace"==t.kind){var a=s(t.newNode);return e.replaceWith(a),t.callback&&t.callback(a),a}if("wholeText"in e)throw new Error("invalid update for Text node");for(var o in t.attributes.remove)e.removeAttribute(o);for(var n in t.attributes.set)e[n]=t.attributes.set[n];return r(e,t.childeren),e},r=function(e,t){for(var r=0,o=0;o<t.length;o++){var n=t[o];if("skip"!=n.kind)if("insert"!=n.kind){var i=e.childNodes[o+r];"remove"!=n.kind?a(i,n):(i.remove(),r-=1)}else e.childNodes[o+r-1]?e.childNodes[o+r-1].after(s(n.node)):e.appendChild(s(n.node))}};t.renderDOM=function(e,t){var a=document.getElementById(e);if(null==a)throw new Error("Container elem not found");var r=a.parentElement;return a.replaceWith(s(t)),r.children[0]}},578:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createText=t.createElement=t.createComponent=void 0,t.createElement=function(e,t){var s=t.key;delete t.key;for(var a=arguments.length,r=new Array(a>2?a-2:0),o=2;o<a;o++)r[o-2]=arguments[o];return{kind:"element",tagname:e,props:t,childeren:r,key:s}},t.createComponent=function(e,t){var s=t.key;return delete t.key,{component:e,props:t,key:s,kind:"component"}},t.createText=function(e){return{key:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",kind:"text",value:e.toString()}}}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,s),o.exports}(()=>{var e=s(352),t=s(582);const a=(e,{children:s,...a})=>{if(void 0===s&&(s=[]),"string"!=typeof e)return a.key="key1"in a?a.key1:e.name,t.Q.createComponent(e,a);a.key="key1"in a?a.key1:e,Array.isArray(s)||(s=[s]);for(let e=0;e<s.length;++e){if(Array.isArray(s[e])){const t=s[e];s.splice(e,1,...t)}"string"==typeof s[e]&&(s[e]=t.Q.createText(s[e]))}return t.Q.createElement(e,a,...s)},r=(e,{children:t,...s})=>a(e,{children:t,...s});class o extends t.Q.Component{render(){return a("button",{className:"button "+this.props.className,onclick:e=>{e.preventDefault(),this.props.onClick&&this.props.onClick(e)},children:this.props.label})}}const n=new class{callbacks=[];register(e){this.callbacks.push(e)}dispatch(e,t=null){const s={type:e,payload:t};this.callbacks.forEach((e=>{e(s)}))}};function i(e){const t=atob(e),s=Uint8Array.from(t,(e=>e.codePointAt(0)));return JSON.parse((new TextDecoder).decode(s))}const c="http://localhost:8080/api";var l=function(e){return e.POST="POST",e.GET="GET",e.DELETE="DELETE",e.PUT="PUT",e}(l||{});const d={Request:async(e,t,s)=>{const a={method:e,mode:"cors",credentials:"include",headers:{...s.headers,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s.body)},r=new URL(c+t);for(const e in s.query)r.searchParams.set(e,s.query[e].toString());try{const e=await fetch(r,a),t={body:null,headers:{},status:503};try{t.body=await e.json()}catch{t.body=null}return t.status=e.status,e.headers.forEach(((e,s)=>{t.headers[s]=e})),t}catch(e){return{body:null,headers:{},status:503}}},Post:async(e,t)=>d.Request(l.POST,e,t),Get:async(e,t)=>d.Request(l.GET,e,t),Put:async(e,t)=>d.Request(l.PUT,e,t),Delete:async(e,t)=>d.Request(l.DELETE,e,t)},h=new class{baseUrl="/auth";Login=async(e,t)=>{console.log(e),console.log(t);const s=await d.Post(this.baseUrl+"/login",{body:{username:e,password:t}});if(200==s.status)return{id:s.body.id,username:s.body.username,create_time:s.body.create_time,image_path:s.body.image_path,jwt:s.headers.authorization};throw Error(s.body.message)};SignUp=async(e,t)=>{const s=await d.Post(this.baseUrl+"/signup",{body:{username:e,password:t}});if(201===s.status)return{id:s.body.id,username:s.body.username,create_time:s.body.create_time,image_path:s.body.image_path,jwt:s.headers.authorization};throw console.log(s.status),Error(s.body.message)};Logout=async e=>{const t=await d.Delete(this.baseUrl+"/logout",{headers:{Authorization:e}});if(204===t.status)return{message:"ok"};throw Error(t.body.message)};CheckUser=async e=>{if(200===(await d.Get(this.baseUrl+"/check_user",{headers:{Authorization:e}})).status)return u.Get(e);throw Error("not authorized")}},p=new class{baseUrl="/note";GetAll=async(e,t=null)=>{const s=await d.Get(this.baseUrl+"/get_all",{headers:{Authorization:e},query:t});if(200===s.status){for(const e of s.body)e.data=i(e.data);return s.body}throw Error(s.body.message)};Get=async(e,t)=>{const s=await d.Get(this.baseUrl+"/"+e,{headers:{Authorization:t}});if(200===s.status)return s.body.data=i(s.body.data),s.body;throw Error(s.body.message)};Delete=async(e,t)=>(await d.Delete(this.baseUrl+"/"+e+"/delete",{headers:{Authorization:t}})).status},u=new class{Get=async e=>{const t=await d.Get("/profile/get",{headers:{Authorization:e}});if(200==t.status)return{id:t.body.id,username:t.body.username,create_time:t.body.create_time,image_path:t.body.image_path}};UpdateAvatar=async(e,t)=>{const s=new FormData;s.append("avatar",e);const a={method:l.POST,mode:"cors",credentials:"include",headers:{Authorization:t},body:s},r=await fetch(c+"/profile/update_avatar/",a);return(await r.json()).image_path};UpdatePassword=async(e,t,s)=>{if(console.log("UpdatePassword"),200!=(await d.Post("/profile/update/",{headers:{Authorization:s},body:{description:"string",password:{new:t,old:e}}})).status)throw Error("Неверный пароль")}};class m{callbacks=new Set;SubscribeToStore(e){this.callbacks.add(e)}UnSubscribeToStore(e){this.callbacks.delete(e)}SetState(e){this.state=e(this.state),this.callbacks.forEach((e=>{e(this.state)}))}}const g=new class extends m{state={JWT:null,username:"",avatarUrl:"",isAuth:!1,errorLoginForm:void 0,errorRegisterForm:void 0,errorUpdatePasswordForm:void 0};constructor(){super(),this.state.JWT=window.localStorage.getItem("Authorization"),this.registerEvents(),this.checkUser()}registerEvents(){n.register((async e=>{switch(e.type){case w.LOGIN:await this.login(e.payload);break;case w.LOGOUT:await this.logout();break;case w.REGISTER:await this.register(e.payload);break;case w.CHECK_USER:await this.checkUser();break;case w.UPDATE_AVATAR:await this.updateAvatar(e.payload);break;case w.UPDATE_PASSWORD:await this.updatePassword(e.payload)}}))}async login(e){this.SetState((e=>({...e,errorLoginForm:void 0})));try{const t=await h.Login(e.username,e.password);this.SetState((e=>({...e,JWT:t.jwt,username:t.username,isAuth:!0,avatarUrl:t.image_path}))),localStorage.setItem("Authorization",this.state.JWT),console.log("login successfull"),J.go("/notes")}catch(e){console.log(e),this.SetState((e=>({...e,errorLoginForm:"Неправильный логин или пароль"})))}}async logout(){try{await h.Logout(this.state.JWT),this.SetState((e=>({...e,isAuth:!1,username:"",avatarUrl:""}))),console.log("logout successful"),J.go("/")}catch(e){console.log(e)}}async register(e){this.SetState((e=>({...e,errorRegisterForm:void 0})));try{const t=await h.SignUp(e.username,e.password);this.SetState((e=>({...e,isAuth:!0,username:t.username,avatarUrl:t.image_path,JWT:t.jwt}))),localStorage.setItem("Authorization",this.state.JWT),console.log("signup successfull"),J.go("/notes")}catch(e){console.log(e),console.log("username already taken"),this.SetState((e=>({...e,errorRegisterForm:"Неправильный пароль"})))}}async checkUser(){try{const e=await h.CheckUser(this.state.JWT);this.SetState((t=>({...t,isAuth:!0,username:e.username,avatarUrl:e.image_path})))}catch(e){console.log("не зареган"),console.log(e)}}async updateAvatar(e){const t=await u.UpdateAvatar(e,this.state.JWT);this.SetState((e=>({...e,avatarUrl:t})))}async updatePassword({oldPassword:e,newPassword:t}){try{console.log("updatePassword"),await u.UpdatePassword(e,t,this.state.JWT),this.SetState((e=>({...e,errorUpdatePasswordForm:void 0})))}catch(e){"Неверный пароль"==e.message&&(console.log("fsdadfasdfasdf"),this.SetState((e=>({...e,errorUpdatePasswordForm:"Неправильный пароль"}))))}}},w={LOGIN:"LOGIN",LOGOUT:"LOGOUT",REGISTER:"REGISTER",CHECK_USER:"CHECK_USER",UPDATE_AVATAR:"UPDATE_AVATAR",UPDATE_PASSWORD:"UPDATE_PASSWORD"};class f extends t.Q.Component{componentDidMount(){document.title="Главная";const e=new IntersectionObserver((function(e,t){e.forEach((e=>{e.isIntersecting&&(e.target.classList.add("animate"),t.unobserve(e.target))}))}));document.querySelectorAll(".second .cards-container .card").forEach((t=>{e.observe(t)}))}render(){return r("div",{className:"home",children:[a("section",{className:"first",children:r("div",{className:"text-container",children:[a("h1",{children:"YouNote - современный сервис для ведения заметок"}),a(o,{onClick:()=>{J.go(g.state.isAuth?"/notes":"/login")},label:"Попробовать"})]})}),r("section",{className:"second",children:[a("h2",{children:"Функции и возможности"}),r("div",{className:"cards-container",children:[r("div",{className:"card",children:[a("img",{src:"./src/assets/notes.png",alt:""}),a("h3",{children:"Многофункциональность"}),a("span",{children:"Сервис может использоваться для любых задач: планирование досуга, ведение конспектов, организация командной работы"})]}),r("div",{className:"card",children:[a("img",{src:"./src/assets/accessibility.png",alt:""}),a("h3",{children:"Доступность"}),a("span",{children:"Можно получить доступ к своим записям, имея под рукой любое устройство с доступом к интернет"})]}),r("div",{className:"card",children:[a("img",{src:"./src/assets/success.png",alt:""}),a("h3",{children:"Удобство"}),a("span",{children:"Простой, минималистичный и интуитивно понятный интерфейс дает возможность комфортного ведения заметок любым пользователем"})]}),r("div",{className:"card",children:[a("img",{src:"./src/assets/personalization.png",alt:""}),a("h3",{children:"Персонализация"}),a("span",{children:"Сервис позволяет оформлять записи, дополняя их картинками, оформляя заметки в соответствии с личными предпочтениями"})]})]})]})]})}}class v extends t.Q.Component{props={err:"Error"};render(){return a("h1",{children:this.props.err})}}class y extends t.Q.Component{state={};componentDidMount(){this.setState((e=>({...e,type:this.props.type?this.props.type:"text",placeholder:this.props.placeholder?this.props.placeholder:"",isPassword:"password"==this.props.type,icon:this.props.icon?this.props.icon:"",hasIcon:null!=this.props.icon})))}toggleInputType=()=>{this.setState((e=>({...e,type:"password"==e.type?"text":"password"})))};handleChange=e=>{this.props.onChange&&this.props.onChange(e.target.value)};render(){return r("div",{className:"input-container "+(this.props.validationResult?"success":"")+(this.props.error?"error":""),children:[a("input",{type:this.state.type,placeholder:this.state.placeholder,value:this.props.value,oninput:this.handleChange}),a("div",{className:"errors-container",children:""!=this.props.error?this.props.error:""}),this.state.isPassword?r("div",{className:"password-toggle-btn-container",onclick:this.toggleInputType,children:[a("img",{className:"password-toggle-btn show-btn",src:"/src/assets/eye-slash.svg",alt:""}),a("img",{className:"password-toggle-btn hide-btn",src:"/src/assets/eye.svg",alt:""})]}):"",this.state.hasIcon?a("img",{className:"icon",src:this.state.icon,alt:""}):""]})}}const S=e=>{for(let t=0;t<e.length;++t)if(!(e.charCodeAt(t)>=97&&e.charCodeAt(t)<=122||e.charCodeAt(t)>=64&&e.charCodeAt(t)<=90||e.charCodeAt(t)>=48&&e.charCodeAt(t)<=57||e.charCodeAt(t)>=35&&e.charCodeAt(t)<=38))return b(!1,"Пароль должен содержать только латинские символы, цифры или символы #$%&");return/[a-zA-Z]/g.test(e)?""===e?b(!1,"Пароль не может быть пустым"):e.length<8?b(!1,"Пароль должен быть не менее 8 символов"):e.length>20?b(!1,"Пароль должен быть короче 20 символов"):b(!0):b(!1,"Пароль должен содержать хотя бы одну букву")},P=e=>{for(let t=0;t<e.length;++t)if(!(e.charCodeAt(t)>=97&&e.charCodeAt(t)<=122||e.charCodeAt(t)>=64&&e.charCodeAt(t)<=90||e.charCodeAt(t)>=48&&e.charCodeAt(t)<=57))return b(!1,"Логин должен содержать только латинские символы или цифры");return""===e?b(!1,"Логин не может быть пустым"):e.length<4?b(!1,"Логин должен быть не менее 4 символов"):e.length>12?b(!1,"Логин должен быть короче 12 символов"):b(!0)},b=(e,t=null)=>({result:e,message:t});class N extends t.Q.Component{state={errorLogin:"",loginValidationResult:!1,login:"",errorPassword:"",passwordValidationResult:!1,password:""};componentDidMount(){g.SubscribeToStore(this.updateState)}componentWillUnmount(){g.UnSubscribeToStore(this.updateState)}updateState=e=>{void 0!==e.errorLoginForm&&(this.setLoginError(e.errorLoginForm),this.setLoginValidated(!1),this.setPasswordError(e.errorLoginForm),this.setPasswordValidated(!1))};handleSubmit=()=>{this.checkLogin(),this.checkPassword(),this.state.loginValidationResult&&this.state.passwordValidationResult&&n.dispatch(w.LOGIN,{username:this.state.login,password:this.state.password})};setLoginValidated=e=>{this.setState((t=>({...t,loginValidationResult:e})))};setLogin=e=>{this.setState((t=>({...t,login:e}))),this.checkLogin()};checkLogin=()=>{const{message:e,result:t}=P(this.state.login);this.setLoginValidated(t),t?this.setLoginError(""):this.setLoginError(e)};setLoginError=e=>{this.setState((t=>({...t,errorLogin:e})))};setPassword=e=>{this.setState((t=>({...t,password:e}))),this.checkPassword()};checkPassword=()=>{const{message:e,result:t}=S(this.state.password);this.setPasswordValidated(t),t?this.setPasswordError(""):this.setPasswordError(e)};setPasswordError=e=>{this.setState((t=>({...t,errorPassword:e})))};setPasswordValidated=e=>{this.setState((t=>({...t,passwordValidationResult:e})))};render(){return r("form",{className:"login-form",children:[a("h3",{children:"Вход"}),a(y,{type:"text",placeholder:"Введите логин",icon:"src/assets/user.png",value:this.state.login,error:this.state.errorLogin,validationResult:this.state.loginValidationResult,onChange:this.setLogin}),a(y,{type:"password",placeholder:"Введите пароль",icon:"src/assets/password.png",value:this.state.password,error:this.state.errorPassword,validationResult:this.state.passwordValidationResult,onChange:this.setPassword}),a(o,{label:"Войти",onClick:this.handleSubmit})]})}}class E extends t.Q.Component{state={login:"",errorLogin:"",loginValidationResult:!1,password:"",errorPassword:"",passwordValidationResult:!1,repeatPassword:"",errorRepeatPassword:"",repeatPasswordValidationResult:!1};componentDidMount(){g.SubscribeToStore(this.updateState)}componentWillUnmount(){g.UnSubscribeToStore(this.updateState)}updateState=e=>{void 0!==e.errorRegisterForm&&(this.setLoginError(e.errorRegisterForm),this.setLoginValidated(!1))};handleSubmit=()=>{this.state.loginValidationResult&&this.state.passwordValidationResult&&this.state.repeatPasswordValidationResult&&n.dispatch(w.REGISTER,{username:this.state.login,password:this.state.password})};setLoginValidated=e=>{this.setState((t=>({...t,loginValidationResult:e})))};setLogin=e=>{this.setState((t=>({...t,login:e})));const{message:t,result:s}=P(e);this.setLoginValidated(s),s?this.setLoginError(""):this.setLoginError(t)};setLoginError=e=>{this.setState((t=>({...t,errorLogin:e})))};setPassword=e=>{if(this.setState((t=>({...t,password:e}))),this.state.password!=this.state.repeatPassword)return this.setRepeatPasswordError("Пароли не совпадают"),this.setPasswordError("Пароли не совпадают"),this.setPasswordValidated(!1),void this.setRepeatPasswordValidated(!1);const{message:t,result:s}=S(e);s?(this.setPasswordValidated(!0),this.setRepeatPasswordValidated(!0),this.setPasswordError(""),this.setRepeatPasswordError("")):(this.setPasswordValidated(!1),this.setPasswordError(t))};setPasswordError=e=>{this.setState((t=>({...t,errorPassword:e})))};setPasswordValidated=e=>{this.setState((t=>({...t,passwordValidationResult:e})))};setRepeatPassword=e=>{if(this.setState((t=>({...t,repeatPassword:e}))),this.state.password!=this.state.repeatPassword)return this.setRepeatPasswordError("Пароли не совпадают"),this.setPasswordError("Пароли не совпадают"),this.setPasswordValidated(!1),void this.setRepeatPasswordValidated(!1);const{message:t,result:s}=S(e);s?(this.setPasswordValidated(!0),this.setRepeatPasswordValidated(!0),this.setRepeatPasswordError(""),this.setPasswordError("")):(this.setRepeatPasswordValidated(!1),this.setRepeatPasswordError(t))};setRepeatPasswordError=e=>{this.setState((t=>({...t,errorRepeatPassword:e})))};setRepeatPasswordValidated=e=>{this.setState((t=>({...t,repeatPasswordValidationResult:e})))};render(){return r("form",{className:"register-form",children:[a("h3",{children:"Регистрация"}),a(y,{type:"text",placeholder:"Придумайте логин",icon:"/src/assets/user.png",onChange:this.setLogin,value:this.state.login,error:this.state.errorLogin,validationResult:this.state.loginValidationResult}),a(y,{type:"password",placeholder:"Придумайте пароль",icon:"src/assets/password.png",value:this.state.password,onChange:this.setPassword,error:this.state.errorPassword,validationResult:this.state.passwordValidationResult}),a(y,{type:"password",placeholder:"Повторите пароль",icon:"src/assets/password.png",value:this.state.repeatPassword,onChange:this.setRepeatPassword,error:this.state.errorRepeatPassword,validationResult:this.state.repeatPasswordValidationResult}),a(o,{label:"Войти",onClick:this.handleSubmit})]})}}class k extends t.Q.Component{state={selectedForm:"login",toggled:!1};componentDidMount(){this.setState((e=>({...e,selectedForm:window.location.pathname.replace("/","")}))),document.title="login"===this.state.selectedForm?"Вход":"Регистрация"}toggleForm=()=>{this.setState((e=>({selectedForm:"login"===e.selectedForm?"register":"login",toggled:!0}))),history.pushState(null,null,this.state.selectedForm),document.title="login"===this.state.selectedForm?"Вход":"Регистрация"};render(){return a("div",{className:"auth-page-wrapper "+(window.location.pathname.includes("login")?"login"===this.state.selectedForm?"":"active":this.state.toggled?"":"active"),children:a("div",{className:"glassmorphism-container",children:r("div",{className:"auth-container",children:[a("div",{className:"form-container sign-in",children:a(N,{})}),a("div",{className:"form-container sign-up"+(this.state.toggled?" fade-left":"")+(window.location.pathname.includes("login")&&this.state.toggled?" fade-right":""),children:a(E,{})}),a("div",{className:"toggle-container",children:r("div",{className:"toggle",children:[r("div",{className:"toggle-panel toggle-left",children:[a("h2",{children:"Уже есть аккаунт?"}),a(o,{label:"Войти",onClick:this.toggleForm})]}),r("div",{className:"toggle-panel toggle-right",children:[a("h2",{children:"Ещё нет аккаунта?"}),a(o,{label:"Зарегистрироваться",onClick:this.toggleForm})]})]})})]})})})}}class R extends t.Q.Component{state={id:0,title:"",content:"",update_time:""};componentDidMount(){this.setState((e=>{return{...e,id:this.props.note.id,title:this.props.note.data.title,content:(s=this.props.note.data.content,50,s.length>50?s.slice(0,49)+"...":s),update_time:(t=this.props.note.update_time,new Intl.DateTimeFormat("ru",{month:"short",day:"numeric",hour:"numeric",minute:"numeric",hourCycle:"h23"}).format(new Date(t)).replace(",",""))};var t,s}))}render(){return r("div",{className:"note-container "+(this.props.selected?"selected":""),id:this.state.id,children:[a("h3",{children:this.state.title}),a("p",{children:this.state.content}),a("span",{className:"update-time",children:this.state.update_time})]})}}class C extends t.Q.Component{handleChange=e=>{this.props.onChange&&this.props.onChange(e.target.value)};render(){return r("div",{className:"search",children:[a("input",{type:"text",className:"search-input",placeholder:"Поиск...",oninput:this.handleChange}),a("img",{src:"/src/assets/search.svg",alt:"",className:"search-icon"})]})}}class T extends t.Q.Component{render(){return a("img",{src:this.props.src,alt:"",className:this.props.className?this.props.className:"",onclick:this.props.onClick})}}const O="SELECT_NOTE",U="SEARCH_NOTES",x="LOAD_NOTES",A="CLOSE_NOTE",L="EXIT_NOTES_PAGE",V="OPEN_DELETE_NOTE_DIALOG",D="CLOSE_DELETE_NOTE_DIALOG",_="DELETE_NOTE",M=new class extends m{state={notes:[],selectedNote:void 0,query:"",offset:0,count:10,modalOpen:!1};constructor(){super(),this.registerEvents()}registerEvents(){n.register((async e=>{switch(e.type){case O:await this.selectNote(e.payload);break;case A:this.closeNote();break;case U:await this.searchNotes(e.payload);break;case x:await this.loadNotes();break;case L:this.exit();break;case V:this.openModal();break;case D:this.closeModal();break;case _:await this.deleteNote()}}))}openModal(){this.SetState((e=>({...e,modalOpen:!0})))}closeModal(){this.SetState((e=>({...e,modalOpen:!1})))}exit(){this.SetState((e=>({...e,query:"",offset:0,selectedNote:void 0,notes:[]})))}closeNote(){this.SetState((e=>({...e,selectedNote:void 0})))}async selectNote(e){const t=await p.Get(e,g.state.JWT);this.SetState((e=>({...e,selectedNote:t})))}async init(){await this.fetchNotes()}async searchNotes(e){this.SetState((t=>({...t,offset:0,query:e}))),await this.fetchNotes(!0)}async loadNotes(){this.SetState((e=>({...e,offset:e.offset+e.count}))),await this.fetchNotes()}async fetchNotes(e=!1){const t={title:this.state.query,offset:this.state.offset,count:this.state.count},s=await p.GetAll(g.state.JWT,t);this.SetState((t=>({...t,notes:e?s:t.notes.concat(s)})))}async deleteNote(){204==await p.Delete(this.state.selectedNote.id,g.state.JWT)&&(this.SetState((e=>({...e,notes:e.notes.filter((e=>e.id!==this.state.selectedNote.id))}))),this.closeNote())}};class j extends t.Q.Component{state={open:!1,selectedNote:void 0};componentDidMount(){M.SubscribeToStore(this.updateState)}closeEditor=()=>{n.dispatch(A)};updateState=e=>{this.setState((t=>({...t,selectedNote:e.selectedNote,open:void 0!==e.selectedNote})))};deleteNote=()=>{n.dispatch(V)};render(){return r("div",{className:"note-editor "+(this.state.open?"active":""),children:[r("div",{className:"top-panel",children:[a("div",{className:"left-container"}),r("div",{className:"right-container",children:[a(T,{src:"/src/assets/trash.svg",className:"icon",onClick:this.deleteNote}),a(T,{src:"/src/assets/close.svg",className:"icon",onClick:this.closeEditor})]})]}),r("div",{className:"bottom-panel",children:[a("div",{className:"note-title-container",contentEditable:"true",children:a("h3",{className:"note-title",children:this.state.selectedNote?.data.title})}),a("div",{className:"note-content",contentEditable:"true",children:a("span",{children:this.state.selectedNote?.data.content})})]})]})}}class F extends t.Q.Component{state={open:!1};componentDidMount(){M.SubscribeToStore(this.updateState),document.addEventListener("click",this.handleClickOutside,!0)}handleClickOutside=e=>{e.target.classList.contains("overlay")&&n.dispatch(D)};componentWillUnmount(){M.UnSubscribeToStore(this.updateState),document.removeEventListener("click",this.handleClickOutside,!0)}updateState=e=>{this.setState((t=>({...t,open:e.modalOpen})))};closeModal=()=>{n.dispatch(D)};deleteNote=()=>{n.dispatch(_),n.dispatch(D)};render(){return r("div",{className:"modal-wrapper "+(this.state.open?"active":""),children:[a("div",{className:"overlay"}),r("div",{className:"modal-content",children:[a("h2",{children:"Удалить заметку?"}),a("span",{children:"Заметка и данные в ней будут удалены без возможности восстановления"}),r("div",{className:"buttons-container",children:[a(o,{label:"Удалить",onClick:this.deleteNote}),a(o,{label:"Отменить",className:"cancel-btn",onClick:this.closeModal})]}),a(T,{src:"/src/assets/close.svg",className:"close-modal-btn",onClick:this.closeModal})]})]})}}class W extends t.Q.Component{state={notes:[],selectedNote:void 0};componentDidMount(){console.log("componentDidMount"),document.title="Заметки",M.SubscribeToStore(this.updateState),M.init().then((()=>{this.createObserver()}))}componentWillUnmount(){n.dispatch(L),M.UnSubscribeToStore(this.updateState)}updateState=e=>{this.setState((t=>(t.notes.length>0&&t.notes.length<M.state.notes.length&&this.createObserver(),{...t,selectedNote:e.selectedNote,notes:e.notes})))};handleSelectNote=e=>{let t;e.target.matches(".note-container")?t=e.target.id:e.target.matches(".note-container *")&&(t=e.target.parentNode.id),t&&n.dispatch(O,t)};createObserver(){new IntersectionObserver((function(e,t){e.forEach((e=>{e.isIntersecting&&(n.dispatch(x),t.unobserve(e.target))}))})).observe(document.querySelector(".note-container:last-child"))}searchNotes=e=>{n.dispatch(U,e)};render(){return r("div",{className:"notes-page-wrapper "+(this.state.selectedNote?"active":""),children:[r("aside",{children:[a(F,{}),a(C,{onChange:this.searchNotes}),a("div",{className:"notes-container",onclick:this.handleSelectNote,children:this.state.notes.map((e=>a(R,{key1:e.id,note:e,selected:this.state.selectedNote?.id==e.id})))})]}),a(j,{})]})}}class G extends t.Q.Component{handleClick(){J.go("/")}render(){return a("div",{className:"logo-wrapper",onclick:this.handleClick,children:a("img",{src:"src/assets/logo.png",alt:""})})}}class I extends t.Q.Component{state={open:!0,timer:void 0};componentDidMount(){this.state.timer=setTimeout((()=>{this.closeToast()}),3e3)}componentWillUnmount(){clearTimeout(this.state.timer)}closeToast=()=>{this.setState((e=>({...e,open:!1}))),setTimeout((()=>{this.props.onHide(this.props.key1)}),300)};formatType(){return this.props.type==Q.SUCCESS?"Успех":this.props.type==Q.ERROR?"Ошибка":"Инфо"}getIcon(){return this.props.type==Q.SUCCESS?"/src/assets/success.svg":this.props.type==Q.ERROR?"/src/assets/error.svg":"/src/assets/info.svg"}render(){return r("div",{className:"toast success "+(this.state.open?"":"hide"),style:`bottom: ${this.props.offset}px`,children:[r("div",{className:"toast-content",children:[a(T,{src:this.getIcon(),className:"toast-icon"}),r("div",{className:"content",children:[a("span",{className:"title",children:this.formatType()}),a("span",{className:"message",children:this.props.message})]})]}),a(T,{src:"/src/assets/close.svg",className:"toast-close-btn",onClick:this.closeToast}),a("div",{className:"progress"})]})}}const Q={SUCCESS:"success",ERROR:"error"};class q extends t.Q.Component{state={toasts:[]};constructor(){super(),z=this}success(e){this.setupToast(Q.SUCCESS,e)}error(e){this.setupToast(Q.ERROR,e)}setupToast=(e,t)=>{this.setState((e=>({...e,toasts:e.toasts.map((e=>(e.offset+=100,e)))})));const s={type:e,message:t,id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),offset:25};this.setState((e=>({...e,toasts:e.toasts.concat(s)})))};removeToast=e=>{const t=this.state.toasts.find((t=>t.id==e));this.setState((e=>({...e,toasts:e.toasts.map((s=>(e.toasts.indexOf(t)>e.toasts.indexOf(s)&&(s.offset-=100),s)))}))),this.setState((t=>({...t,toasts:t.toasts.filter((t=>t.id!==e))})))};render(){return a("div",{className:"toasts-wrapper",children:this.state.toasts.map((e=>a(I,{key1:e.id,type:e.type,message:e.message,onHide:this.removeToast,offset:e.offset})))})}}let z,J;class H extends t.Q.Component{state={password:"",errorPassword:"",passwordValidationResult:!1,repeatPassword:"",errorRepeatPassword:"",repeatPasswordValidationResult:!1};componentDidMount(){g.SubscribeToStore(this.updateState),document.addEventListener("click",this.handleClickOutside,!0)}componentWillUnmount(){g.UnSubscribeToStore(this.updateState),document.removeEventListener("click",this.handleClickOutside,!0)}handleClickOutside=e=>{e.target.classList.contains("overlay")&&this.closeModal()};updateState=e=>{"Неправильный пароль"==e.errorUpdatePasswordForm?(this.setPasswordError("Неправильный пароль"),this.setPasswordValidated(!1)):(console.log("fasdfasdfasdfasdfasdfasdfasdfsdf"),this.closeModal(),z.success("Пароль успешно изменен"))};closeModal=()=>{console.log("closeModal"),this.props.closeModal()};setPassword=e=>{this.setState((t=>({...t,password:e}))),this.checkPassword(),this.checkRepeatPassword()};checkPassword=()=>{if(this.state.password.length>0&&this.state.password==this.state.repeatPassword)return this.setRepeatPasswordError("Пароли совпадают"),this.setPasswordError("Пароли совпадают"),this.setPasswordValidated(!1),void this.setRepeatPasswordValidated(!1);const{message:e,result:t}=S(this.state.password);t?(this.setPasswordValidated(!0),this.setPasswordError("")):(this.setPasswordValidated(!1),this.setPasswordError(e))};setPasswordError=e=>{this.setState((t=>({...t,errorPassword:e})))};setPasswordValidated=e=>{this.setState((t=>({...t,passwordValidationResult:e})))};setRepeatPassword=e=>{this.setState((t=>({...t,repeatPassword:e}))),this.checkPassword(),this.checkRepeatPassword()};checkRepeatPassword=()=>{if(this.state.repeatPassword.length>0&&this.state.password==this.state.repeatPassword)return this.setRepeatPasswordError("Пароли совпадают"),this.setPasswordError("Пароли совпадают"),this.setPasswordValidated(!1),void this.setRepeatPasswordValidated(!1);const{message:e,result:t}=S(this.state.repeatPassword);t?(this.setRepeatPasswordValidated(!0),this.setRepeatPasswordError("")):(this.setRepeatPasswordValidated(!1),this.setRepeatPasswordError(e))};setRepeatPasswordError=e=>{this.setState((t=>({...t,errorRepeatPassword:e})))};setRepeatPasswordValidated=e=>{this.setState((t=>({...t,repeatPasswordValidationResult:e})))};handleSubmit=()=>{this.checkPassword(),this.checkRepeatPassword(),this.state.passwordValidationResult&&this.state.repeatPasswordValidationResult&&n.dispatch(w.UPDATE_PASSWORD,{oldPassword:this.state.password,newPassword:this.state.repeatPassword})};render(){return r("div",{className:"modal-wrapper "+(this.props.open?"active":""),children:[a("div",{className:"overlay"}),r("div",{className:"modal-content change-password-form",children:[a("h2",{children:"Форма изменения пароля"}),a(y,{placeholder:"Старый пароль",icon:"src/assets/password.png",value:this.state.password,onChange:this.setPassword,error:this.state.errorPassword,validationResult:this.state.passwordValidationResult}),a(y,{placeholder:"Новый пароль",icon:"src/assets/password.png",value:this.state.repeatPassword,onChange:this.setRepeatPassword,error:this.state.errorRepeatPassword,validationResult:this.state.repeatPasswordValidationResult}),a(o,{label:"Изменить",onClick:this.handleSubmit}),a(T,{src:"/src/assets/close.svg",className:"close-modal-btn",onClick:this.closeModal})]})]})}}class K extends t.Q.Component{state={open:!1,updatePasswordFormOpen:!1,inUpload:!1};componentDidMount(){document.addEventListener("click",this.handleClickOutside,!0)}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside,!0)}handleClickOutside=e=>{document.querySelector(".toast")?.contains(e.target)||document.querySelector(".toggle-profile-button")?.contains(e.target)||document.querySelector(".popup-content")?.contains(e.target)||document.querySelector(".modal-wrapper")?.contains(e.target)||this.close()};close=()=>{this.setState((e=>({...e,open:!1})))};toggleOpen=()=>{this.setState((e=>({...e,open:!e.open})))};handleLogout=async()=>{n.dispatch(w.LOGOUT)};handlePhotoUpload=e=>{const t=e.target.files[0];if(t.size>5242880)return z.error("Фото слишком большое"),console.log(e.target),void(e.target.value=null);this.setState((e=>({...e,inUpload:!0}))),n.dispatch(w.UPDATE_AVATAR,t),setTimeout((()=>{this.setState((e=>({...e,inUpload:!1}))),e.target.value=null}),3e3)};openModal=()=>{this.setState((e=>({...e,updatePasswordFormOpen:!0})))};closeModal=()=>{console.log("closeModal"),this.setState((e=>({...e,updatePasswordFormOpen:!1})))};render(){return r("div",{className:"user-profile-wrapper "+(this.state.open?"open":""),children:[r("div",{className:"toggle-profile-button",onclick:this.toggleOpen,children:[a("div",{className:"slider one"}),a("div",{className:"slider two"}),a("div",{className:"slider three"})]}),a("div",{className:"panel",children:r("div",{className:"popup-content",children:[r("div",{className:"user-avatar-container",children:[a(T,{src:"http://localhost/images/"+this.props.avatarUrl,className:"user-avatar "+(this.state.inUpload?"loading":"")}),r("form",{className:"upload-preview",children:[a("input",{type:"file",accept:".jpg,.png",id:"upload-image-input",hidden:"true",onchange:this.handlePhotoUpload}),a("label",{htmlFor:"upload-image-input"}),a(T,{src:"src/assets/photo.svg",className:"upload-preview-icon"})]}),r("div",{className:"progress-wrapper "+(this.state.inUpload?"active":""),children:[a("div",{className:"inner"}),r("div",{className:"checkmark",children:[a("span",{}),a("span",{})]}),r("div",{className:"circle",children:[a("div",{className:"bar left",children:a("div",{className:"progress"})}),a("div",{className:"bar right",children:a("div",{className:"progress"})})]})]})]}),a("span",{className:"username",children:g.state.username}),a("span",{className:"change-password-btn",onclick:this.openModal,children:"Изменить пароль"}),a(o,{label:"Выйти",className:"logout-btn",onClick:this.handleLogout})]})}),this.state.updatePasswordFormOpen?a(H,{open:this.state.updatePasswordFormOpen,closeModal:this.closeModal}):""]})}}class $ extends t.Q.Component{state={isAuth:!1,avatarUrl:""};componentDidMount(){g.SubscribeToStore(this.updateState)}updateState=e=>{this.setState((t=>({...t,isAuth:e.isAuth,avatarUrl:e.avatarUrl})))};render(){return r("header",{id:"header",children:[a(G,{}),this.state.isAuth?a(K,{avatarUrl:this.state.avatarUrl}):this.props.currPage!==k?a(o,{label:"Вход",onClick:()=>J.go("/login")}):""]})}}class Y extends t.Q.Component{render(){return r("div",{className:"background",children:[a("div",{className:"parallax-bg"}),a("div",{id:"stars"}),a("div",{id:"stars2"}),a("div",{id:"stars3"})]})}}class B extends t.Q.Component{state={currPage:f,PageProps:{}};constructor(){super(),J=this,this.pages=new Map,this.initPages()}componentDidMount(){const e=window.location.pathname;window.addEventListener("popstate",(()=>{this.go(window.location.pathname)})),this.go(e)}initPages=()=>{this.pages["/"]={page:f,pageProps:{}},this.pages["/login"]={page:k,pageProps:{needAuth:!1}},this.pages["/register"]={page:k,pageProps:{needAuth:!1}},this.pages["/notes"]={page:W,pageProps:{needAuth:!0}}};go(e){const t=this.pages[e];history.pushState({path:e},"",e),void 0!==t?void 0!==t.loader?t.loader().then((e=>{this.setState((s=>({...s,currPage:t.page,PageProps:e})))})).catch((e=>{this.setState((t=>({...t,currPage:v,PageProps:{err:e}})))})):this.setState((e=>({...e,currPage:t.page}))):this.setState((e=>({...e,currPage:v,PageProps:{err:"404 NotFound"}})))}render(){return r("div",{children:[a(q,{}),a($,{currPage:this.state.currPage}),t.Q.createComponent(this.state.currPage,{...this.state.PageProps,key:this.state.currPage.name}),this.state.currPage!==W?a(Y,{currPage:this.state.currPage}):""]})}}class X extends t.Q.Component{render(){return a(B,{})}}(0,e.renderDOM)("root",t.Q.createComponent(X,{}))})()})();