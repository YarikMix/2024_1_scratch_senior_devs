!function(){"use strict";var e={405:function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var a=s(286),o=s(352);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,i(a.key),a)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,"string");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:String(t)}t.Component=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,s;return t=e,(s=[{key:"setState",value:function(e){if(null==this.mountedElement)throw new Error("you are updating an unmounted component");this.state=e(this.state),(0,o.applyUpdate)(this.mountedElement,this.getUpdateDiff())}},{key:"setProps",value:function(e){if(null==this.mountedElement)throw new Error("You are setting the props of an inmounted component");return this.state=this.componentWillRecieveProps(e,this.state),this.props=e,this.getUpdateDiff()}},{key:"initProps",value:function(e){return this.props=e,this.currentRootNode=this.render(),this.currentRootNode}},{key:"getUpdateDiff",value:function(){var e=this,t=this.render(),s=(0,a.createDiff)(this.currentRootNode,t);return"replace"==s.kind&&(s.callback=function(t){return e.mountedElement=t}),this.currentRootNode=t,setTimeout((function(){return e.componentDidUpdate()})),s}},{key:"notifyMounted",value:function(e){var t=this;this.mountedElement=e,setTimeout((function(){return t.componentDidMount()}))}},{key:"unmount",value:function(){this.componentWillUnmount(),this.mountedElement=null}},{key:"componentDidMount",value:function(){}},{key:"componentWillRecieveProps",value:function(e,t){return t}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillUnmount",value:function(){}}])&&n(t.prototype,s),Object.defineProperty(t,"prototype",{writable:!1}),e}()},286:function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0}),t.createDiff=void 0;var a=s(10);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var s=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=s){var a,o,r,n,i=[],c=!0,l=!1;try{if(r=(s=s.call(e)).next,0===t){if(Object(s)!==s)return;c=!1}else for(;!(c=(a=r.call(s)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=s.return&&(n=s.return(),Object(n)!==n))return}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function i(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?i(Object(s),!0).forEach((function(t){l(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function l(e,t,s){var a;return a=function(e,t){if("object"!=o(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,"string");if("object"!=o(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==o(a)?a:String(a))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var d=function(e){return{kind:"replace",newNode:e}},h=t.createDiff=function(e,t){return"text"==e.kind&&"text"==t.kind&&e.value==t.value?{kind:"skip"}:"text"==e.kind||"text"==t.kind?d(t):"component"==e.kind&&"component"==t.kind&&e.component==t.component&&e.instance?(t.instance=e.instance,(0,a.isEqual)(e.props,t.props)?{kind:"skip"}:t.instance.setProps(t.props)):"component"==e.kind?(e.instance.unmount(),e.instance=null,d(t)):"component"==t.kind?(t.instance=new t.component,{kind:"replace",newNode:t.instance.initProps(t.props),callback:function(e){return t.instance.notifyMounted(e)}}):e.tagname!=t.tagname?d(t):{kind:"update",attributes:{remove:Object.keys(e.props||{}).filter((function(e){return-1==Object.keys(t).indexOf(e)})),set:Object.keys(t.props||{}).filter((function(s){return e.props[s]!=t.props[s]})).reduce((function(e,s){return c(c({},e),{},l({},s,t.props[s]))}),{})},childeren:m(e.childeren||[],t.childeren||[])}},p=function(e,t,s){for(;t[0]&&t[0][0]!=s;)"component"==t[0][1].kind&&(t[0][1].instance.unmount(),t[0][1].instance=null),e.push({kind:"remove"}),t.shift()},u=function(e,t,s){for(;t[0]&&t[0][0]!=s;)e.push({kind:"insert",node:t.shift()[1]})},m=function(e,t){for(var s=e.map((function(e){return[e.key,e]})),a=t.map((function(e){return[e.key,e]})),o=[],n=r(s.find((function(e){return-1!=a.map((function(e){return e[0]})).indexOf(e[0])}))||[null],1)[0];n;)p(o,s,n),u(o,a,n),o.push(h(s.shift()[1],a.shift()[1])),n=r(s.find((function(e){return-1!=a.map((function(e){return e[0]})).indexOf(e[0])}))||[null],1)[0];return p(o,s,void 0),u(o,a,void 0),o}},582:function(e,t,s){t.Q=void 0;var a=s(405),o=s(578);t.Q={createElement:o.createElement,createText:o.createText,createComponent:o.createComponent,Component:a.Component}},10:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isEqual=void 0,t.isEqual=function e(t,s){if(t===s)return!0;if((void 0===t||void 0===s||null===t||null===s)&&(t||s))return!1;var a=null==t?void 0:t.constructor.name;if(a!==(null==s?void 0:s.constructor.name))return!1;if("Array"===a){if(t.length!==s.length)return!1;for(var o=!0,r=0;r<t.length;r++)if(!e(t[r],s[r])){o=!1;break}return o}if("Object"===a){var n=!0,i=Object.keys(t),c=Object.keys(s);if(i.length!==c.length)return!1;for(var l=0;l<i.length;l++)if(t[i[l]]&&s[i[l]]){if(t[i[l]]===s[i[l]])continue;if(!t[i[l]]||"Array"!==t[i[l]].constructor.name&&"Object"!==t[i[l]].constructor.name){if(t[i[l]]!==s[i[l]]){n=!1;break}}else if(!(n=e(t[i[l]],s[i[l]])))break}else if(t[i[l]]&&!s[i[l]]||!t[i[l]]&&s[i[l]]){n=!1;break}return n}return t===s}},352:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.renderDOM=t.applyUpdate=void 0;var s=function e(t){if("text"==t.kind)return document.createTextNode(t.value);if("component"==t.kind){if(t.instance){var s=e(t.instance.render());return t.instance.notifyMounted(s),s}t.instance=new t.component;var a=e(t.instance.initProps(t.props));return t.instance.notifyMounted(a),a}var o=document.createElement(t.tagname);for(var r in t.props||{})o[r]=t.props[r];return(t.childeren||[]).forEach((function(t){return o.appendChild(e(t))})),o},a=t.applyUpdate=function(e,t){if("skip"==t.kind)return e;if("replace"==t.kind){var a=s(t.newNode);return e.replaceWith(a),t.callback&&t.callback(a),a}if("wholeText"in e)throw new Error("invalid update for Text node");for(var r in t.attributes.remove)e.removeAttribute(r);for(var n in t.attributes.set)e[n]=t.attributes.set[n];return o(e,t.childeren),e},o=function(e,t){for(var o=0,r=0;r<t.length;r++){var n=t[r];if("skip"!=n.kind)if("insert"!=n.kind){var i=e.childNodes[r+o];"remove"!=n.kind?a(i,n):(i.remove(),o-=1)}else e.childNodes[r+o-1]?e.childNodes[r+o-1].after(s(n.node)):e.appendChild(s(n.node))}};t.renderDOM=function(e,t){var a=document.getElementById(e);if(null==a)throw new Error("Container elem not found");var o=a.parentElement;return a.replaceWith(s(t)),o.children[0]}},578:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createText=t.createElement=t.createComponent=void 0,t.createElement=function(e,t){var s=t.key;delete t.key;for(var a=arguments.length,o=new Array(a>2?a-2:0),r=2;r<a;r++)o[r-2]=arguments[r];return{kind:"element",tagname:e,props:t,childeren:o,key:s}},t.createComponent=function(e,t){var s=t.key;return delete t.key,{component:e,props:t,key:s,kind:"component"}},t.createText=function(e){return{key:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",kind:"text",value:e.toString()}}}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,s),r.exports}!function(){var e=s(352),t=s(582);const a=(e,{children:s,...a})=>{if(void 0===s&&(s=[]),"string"!=typeof e)return a.key="key1"in a?a.key1:e.name,t.Q.createComponent(e,a);a.key="key1"in a?a.key1:e,Array.isArray(s)||(s=[s]);for(let e=0;e<s.length;++e){if(Array.isArray(s[e])){const t=s[e];s.splice(e,1,...t)}"string"==typeof s[e]&&(s[e]=t.Q.createText(s[e]))}return t.Q.createElement(e,a,...s)},o=(e,{children:t,...s})=>a(e,{children:t,...s});class r extends t.Q.Component{render(){return a("button",{className:"button "+this.props.className,onclick:e=>{e.preventDefault(),this.props.onClick&&this.props.onClick(e)},children:this.props.label})}}const n=new class{callbacks=[];register(e){this.callbacks.push(e)}dispatch(e,t=null){const s={type:e,payload:t};this.callbacks.forEach((e=>{e(s)}))}};function i(e){const t=atob(e),s=Uint8Array.from(t,(e=>e.codePointAt(0)));return JSON.parse((new TextDecoder).decode(s))}const c=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),l="https://you-note.ru/api";var d=function(e){return e.POST="POST",e.GET="GET",e.DELETE="DELETE",e.PUT="PUT",e}(d||{});const h={Request:async(e,t,s)=>{const a={method:e,mode:"cors",credentials:"include",headers:{...s.headers,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s.body)},o=new URL(l+t);for(const e in s.query)o.searchParams.set(e,s.query[e].toString());try{const e=await fetch(o,a),t={body:null,headers:{},status:503};try{t.body=await e.json()}catch{t.body=null}return t.status=e.status,e.headers.forEach(((e,s)=>{t.headers[s]=e})),t}catch(e){return{body:null,headers:{},status:503}}},Post:async(e,t)=>h.Request(d.POST,e,t),Get:async(e,t)=>h.Request(d.GET,e,t),Put:async(e,t)=>h.Request(d.PUT,e,t),Delete:async(e,t)=>h.Request(d.DELETE,e,t)},p=new class{baseUrl="/auth";Login=async(e,t)=>{const s=await h.Post(this.baseUrl+"/login",{body:{username:e,password:t}});if(200==s.status)return{id:s.body.id,username:s.body.username,create_time:s.body.create_time,image_path:s.body.image_path,jwt:s.headers.authorization};throw Error(s.body.message)};SignUp=async(e,t)=>{const s=await h.Post(this.baseUrl+"/signup",{body:{username:e,password:t}});if(201===s.status)return{id:s.body.id,username:s.body.username,create_time:s.body.create_time,image_path:s.body.image_path,jwt:s.headers.authorization};throw Error(s.body.message)};Logout=async e=>{const t=await h.Delete(this.baseUrl+"/logout",{headers:{Authorization:e}});if(204===t.status)return{message:"ok"};throw Error(t.body.message)};CheckUser=async e=>{if(200===(await h.Get(this.baseUrl+"/check_user",{headers:{Authorization:e}})).status)return m.Get(e);throw Error("not authorized")}},u=new class{baseUrl="/note";GetAll=async(e,t=null)=>{const s=await h.Get(this.baseUrl+"/get_all",{headers:{Authorization:e},query:t});if(200===s.status){for(const e of s.body)e.data=i(e.data);return s.body}throw Error(s.body.message)};Get=async(e,t)=>{const s=await h.Get(this.baseUrl+"/"+e,{headers:{Authorization:t}});if(200===s.status)return s.body.data=i(s.body.data),s.body;throw Error(s.body.message)};Delete=async(e,t)=>(await h.Delete(this.baseUrl+"/"+e+"/delete",{headers:{Authorization:t}})).status;Update=async(e,t)=>{const s=await h.Post(this.baseUrl+"/"+e.id+"/edit",{headers:{Authorization:t},body:{data:e}});return s.body.data=i(s.body.data),s.body};Add=async e=>{const t=await h.Post(this.baseUrl+"/add",{headers:{Authorization:e},body:{data:{content:c(),title:"Новая заметка"}}});return console.log(t.status),console.log(t.body),t.body.data=i(t.body.data),t.body}},m=new class{Get=async e=>{const t=await h.Get("/profile/get",{headers:{Authorization:e}});if(200==t.status)return{id:t.body.id,username:t.body.username,create_time:t.body.create_time,image_path:t.body.image_path}};UpdateAvatar=async(e,t)=>{const s=new FormData;s.append("avatar",e);const a={method:d.POST,mode:"cors",credentials:"include",headers:{Authorization:t},body:s},o=await fetch(l+"/profile/update_avatar/",a);return(await o.json()).image_path};UpdatePassword=async(e,t,s)=>{if(console.log("UpdatePassword"),200!=(await h.Post("/profile/update/",{headers:{Authorization:s},body:{description:"string",password:{new:t,old:e}}})).status)throw Error("Неверный пароль")}};class g{callbacks=new Set;SubscribeToStore(e){this.callbacks.add(e)}UnSubscribeToStore(e){this.callbacks.delete(e)}SetState(e){this.state=e(this.state),this.callbacks.forEach((e=>{e(this.state)}))}}class w extends t.Q.Component{render(){return a("img",{src:this.props.src,alt:"",className:this.props.className?this.props.className:"",onclick:this.props.onClick})}}class v extends t.Q.Component{state={open:!0,timer:void 0};componentDidMount(){this.setState((e=>({...e,timer:setTimeout((()=>{this.closeToast()}),3e3)})))}componentWillUnmount(){clearTimeout(this.state.timer)}closeToast=()=>{this.setState((e=>({...e,open:!1}))),setTimeout((()=>{this.props.onHide(this.props.key1)}),300)};formatType(){return this.props.type==f.SUCCESS?"Успех":this.props.type==f.ERROR?"Ошибка":"Инфо"}getIcon(){return this.props.type==f.SUCCESS?"/src/assets/success.svg":this.props.type==f.ERROR?"/src/assets/error.svg":"/src/assets/info.svg"}render(){return o("div",{className:"toast success "+(this.state.open?"":"hide"),style:`bottom: ${this.props.offset}px`,children:[o("div",{className:"toast-content",children:[a(w,{src:this.getIcon(),className:"toast-icon"}),o("div",{className:"content",children:[a("span",{className:"title",children:this.formatType()}),a("span",{className:"message",children:this.props.message})]})]}),a(w,{src:"/src/assets/close.svg",className:"toast-close-btn",onClick:this.closeToast}),a("div",{className:"progress"})]})}}const f={SUCCESS:"success",ERROR:"error"};class y extends t.Q.Component{state={toasts:[]};constructor(){super(),S=this}success(e){this.setupToast(f.SUCCESS,e)}error(e){this.setupToast(f.ERROR,e)}setupToast=(e,t)=>{this.setState((e=>({...e,toasts:e.toasts.map((e=>(e.offset+=100,e)))})));const s={type:e,message:t,id:c(),offset:25};this.setState((e=>({...e,toasts:e.toasts.concat(s)})))};removeToast=e=>{const t=this.state.toasts.find((t=>t.id==e));this.setState((e=>({...e,toasts:e.toasts.map((s=>(e.toasts.indexOf(t)>e.toasts.indexOf(s)&&(s.offset-=100),s)))}))),this.setState((t=>({...t,toasts:t.toasts.filter((t=>t.id!==e))})))};render(){return a("div",{children:this.state.toasts.map((e=>a(v,{key1:e.id,type:e.type,message:e.message,onHide:this.removeToast,offset:e.offset})))})}}let S;const b=new class extends g{state={JWT:null,username:"",avatarUrl:"",isAuth:!1,errorLoginForm:void 0,errorRegisterForm:void 0,errorUpdatePasswordForm:void 0,updatePasswordFormOpen:!1};constructor(){super(),this.state.JWT=window.localStorage.getItem("Authorization"),this.registerEvents()}registerEvents(){n.register((async e=>{switch(e.type){case P.LOGIN:await this.login(e.payload);break;case P.LOGOUT:await this.logout();break;case P.REGISTER:await this.register(e.payload);break;case P.CHECK_USER:await this.checkUser();break;case P.UPDATE_AVATAR:await this.updateAvatar(e.payload);break;case P.UPDATE_PASSWORD:await this.updatePassword(e.payload);break;case P.OPEN_CHANGE_PASSWORD_FORM:this.openChangePasswordForm();break;case P.CLOSE_CHANGE_PASSWORD_FORM:this.closeChangePasswordForm()}}))}async login(e){this.SetState((e=>({...e,errorLoginForm:void 0})));try{const t=await p.Login(e.username,e.password);this.SetState((e=>({...e,JWT:t.jwt,username:t.username,isAuth:!0,avatarUrl:t.image_path}))),localStorage.setItem("Authorization",this.state.JWT),console.log("login successfull"),ne.go("/notes")}catch(e){console.log(e),this.SetState((e=>({...e,errorLoginForm:"Неправильный логин или пароль"})))}}async logout(){try{await p.Logout(this.state.JWT),this.SetState((e=>({...e,isAuth:!1,username:"",avatarUrl:""}))),console.log("logout successful"),ne.go("/")}catch(e){console.log(e)}}async register(e){this.SetState((e=>({...e,errorRegisterForm:void 0})));try{const t=await p.SignUp(e.username,e.password);this.SetState((e=>({...e,isAuth:!0,username:t.username,avatarUrl:t.image_path,JWT:t.jwt}))),localStorage.setItem("Authorization",this.state.JWT),console.log("signup successfull"),ne.go("/notes")}catch(e){console.log(e),console.log("username already taken"),this.SetState((e=>({...e,errorRegisterForm:"Неправильный пароль"})))}}async checkUser(){try{const e=await p.CheckUser(this.state.JWT);this.SetState((t=>({...t,isAuth:!0,username:e.username,avatarUrl:e.image_path})))}catch(e){console.log("не зареган"),console.log(e),this.SetState((e=>({...e,isAuth:!1})))}}async updateAvatar(e){const t=await m.UpdateAvatar(e,this.state.JWT);this.SetState((e=>({...e,avatarUrl:t})))}async updatePassword({oldPassword:e,newPassword:t}){try{await m.UpdatePassword(e,t,this.state.JWT),S.success("Пароль успешно изменен"),this.closeChangePasswordForm()}catch(e){"Неверный пароль"==e.message&&(S.error("Неверный пароль"),this.SetState((e=>({...e,errorUpdatePasswordForm:"Неправильный пароль"}))))}}openChangePasswordForm(){this.SetState((e=>({...e,updatePasswordFormOpen:!0})))}closeChangePasswordForm(){this.SetState((e=>({...e,updatePasswordFormOpen:!1,errorUpdatePasswordForm:void 0})))}},P={LOGIN:"LOGIN",LOGOUT:"LOGOUT",REGISTER:"REGISTER",CHECK_USER:"CHECK_USER",UPDATE_AVATAR:"UPDATE_AVATAR",UPDATE_PASSWORD:"UPDATE_PASSWORD",OPEN_CHANGE_PASSWORD_FORM:"OPEN_CHANGE_PASSWORD_FORM",CLOSE_CHANGE_PASSWORD_FORM:"CLOSE_CHANGE_PASSWORD_FORM"};class N extends t.Q.Component{componentDidMount(){document.title="Главная";const e=new IntersectionObserver((function(e,t){e.forEach((e=>{e.isIntersecting&&(e.target.classList.add("animate"),t.unobserve(e.target))}))}));document.querySelectorAll(".second .cards-container .card").forEach((t=>{e.observe(t)}))}render(){return o("div",{className:"home",children:[a("section",{className:"first",children:o("div",{className:"text-container",children:[a("h1",{children:"YouNote - современный сервис для ведения заметок"}),a(r,{onClick:()=>{ne.go(b.state.isAuth?"/notes":"/login")},label:"Попробовать"})]})}),o("section",{className:"second",children:[a("h2",{children:"Функции и возможности"}),o("div",{className:"cards-container",children:[o("div",{className:"card",children:[a("img",{src:"./src/assets/notes.png",alt:""}),a("h3",{children:"Многофункциональность"}),a("span",{children:"Сервис может использоваться для любых задач: планирование досуга, ведение конспектов, организация командной работы"})]}),o("div",{className:"card",children:[a("img",{src:"./src/assets/accessibility.png",alt:""}),a("h3",{children:"Доступность"}),a("span",{children:"Можно получить доступ к своим записям, имея под рукой любое устройство с доступом к интернет"})]}),o("div",{className:"card",children:[a("img",{src:"./src/assets/success.png",alt:""}),a("h3",{children:"Удобство"}),a("span",{children:"Простой, минималистичный и интуитивно понятный интерфейс дает возможность комфортного ведения заметок любым пользователем"})]}),o("div",{className:"card",children:[a("img",{src:"./src/assets/personalization.png",alt:""}),a("h3",{children:"Персонализация"}),a("span",{children:"Сервис позволяет оформлять записи, дополняя их картинками, оформляя заметки в соответствии с личными предпочтениями"})]})]})]})]})}}class E extends t.Q.Component{props={err:"Error"};render(){return a("h1",{children:this.props.err})}}class k extends t.Q.Component{state={};componentDidMount(){this.setState((e=>({...e,type:this.props.type?this.props.type:"text",placeholder:this.props.placeholder?this.props.placeholder:"",isPassword:"password"==this.props.type,icon:this.props.icon?this.props.icon:"",hasIcon:null!=this.props.icon})))}toggleInputType=()=>{this.setState((e=>({...e,type:"password"==e.type?"text":"password"})))};handleChange=e=>{this.props.onChange&&this.props.onChange(e.target.value)};render(){return o("div",{className:"input-container "+(this.props.validationResult?"success":"")+(this.props.error?"error":""),children:[a("input",{type:this.state.type,placeholder:this.state.placeholder,value:this.props.value,oninput:this.handleChange}),a("div",{className:"errors-container",children:""!=this.props.error?this.props.error:""}),this.state.isPassword?o("div",{className:"password-toggle-btn-container",onclick:this.toggleInputType,children:[a("img",{className:"password-toggle-btn show-btn",src:"/src/assets/eye-slash.svg",alt:""}),a("img",{className:"password-toggle-btn hide-btn",src:"/src/assets/eye.svg",alt:""})]}):"",this.state.hasIcon?a("img",{className:"icon",src:this.state.icon,alt:""}):""]})}}const C=e=>{for(let t=0;t<e.length;++t)if(!(e.charCodeAt(t)>=97&&e.charCodeAt(t)<=122||e.charCodeAt(t)>=64&&e.charCodeAt(t)<=90||e.charCodeAt(t)>=48&&e.charCodeAt(t)<=57||e.charCodeAt(t)>=35&&e.charCodeAt(t)<=38))return O(!1,"Пароль должен содержать только латинские символы, цифры или символы #$%&");return/[a-zA-Z]/g.test(e)?""===e?O(!1,"Пароль не может быть пустым"):e.length<8?O(!1,"Пароль должен быть не менее 8 символов"):e.length>20?O(!1,"Пароль должен быть короче 20 символов"):O(!0):O(!1,"Пароль должен содержать хотя бы одну букву")},R=e=>{for(let t=0;t<e.length;++t)if(!(e.charCodeAt(t)>=97&&e.charCodeAt(t)<=122||e.charCodeAt(t)>=64&&e.charCodeAt(t)<=90||e.charCodeAt(t)>=48&&e.charCodeAt(t)<=57))return O(!1,"Логин должен содержать только латинские символы или цифры");return""===e?O(!1,"Логин не может быть пустым"):e.length<4?O(!1,"Логин должен быть не менее 4 символов"):e.length>12?O(!1,"Логин должен быть короче 12 символов"):O(!0)},O=(e,t=null)=>({result:e,message:t});class T extends t.Q.Component{state={errorLogin:"",loginValidationResult:!1,login:"",errorPassword:"",passwordValidationResult:!1,password:""};componentDidMount(){b.SubscribeToStore(this.updateState)}componentWillUnmount(){b.UnSubscribeToStore(this.updateState)}updateState=e=>{void 0!==e.errorLoginForm&&(this.setLoginError(e.errorLoginForm),this.setLoginValidated(!1),this.setPasswordError(e.errorLoginForm),this.setPasswordValidated(!1))};handleSubmit=()=>{this.checkLogin(),this.checkPassword(),this.state.loginValidationResult&&this.state.passwordValidationResult&&n.dispatch(P.LOGIN,{username:this.state.login,password:this.state.password})};setLoginValidated=e=>{this.setState((t=>({...t,loginValidationResult:e})))};setLogin=e=>{this.setState((t=>({...t,login:e}))),this.checkLogin()};checkLogin=()=>{const{message:e,result:t}=R(this.state.login);this.setLoginValidated(t),t?this.setLoginError(""):this.setLoginError(e)};setLoginError=e=>{this.setState((t=>({...t,errorLogin:e})))};setPassword=e=>{this.setState((t=>({...t,password:e}))),this.checkPassword()};checkPassword=()=>{const{message:e,result:t}=C(this.state.password);this.setPasswordValidated(t),t?this.setPasswordError(""):this.setPasswordError(e)};setPasswordError=e=>{this.setState((t=>({...t,errorPassword:e})))};setPasswordValidated=e=>{this.setState((t=>({...t,passwordValidationResult:e})))};render(){return o("form",{className:"login-form",children:[a("h3",{children:"Вход"}),a(k,{type:"text",placeholder:"Введите логин",icon:"src/assets/user.png",value:this.state.login,error:this.state.errorLogin,validationResult:this.state.loginValidationResult,onChange:this.setLogin}),a(k,{type:"password",placeholder:"Введите пароль",icon:"src/assets/password.png",value:this.state.password,error:this.state.errorPassword,validationResult:this.state.passwordValidationResult,onChange:this.setPassword}),a(r,{label:"Войти",onClick:this.handleSubmit})]})}}class A extends t.Q.Component{state={login:"",errorLogin:"",loginValidationResult:!1,password:"",errorPassword:"",passwordValidationResult:!1,repeatPassword:"",errorRepeatPassword:"",repeatPasswordValidationResult:!1};componentDidMount(){b.SubscribeToStore(this.updateState)}componentWillUnmount(){b.UnSubscribeToStore(this.updateState)}updateState=e=>{void 0!==e.errorRegisterForm&&(this.setLoginError(e.errorRegisterForm),this.setLoginValidated(!1))};handleSubmit=()=>{this.state.loginValidationResult&&this.state.passwordValidationResult&&this.state.repeatPasswordValidationResult&&n.dispatch(P.REGISTER,{username:this.state.login,password:this.state.password})};setLoginValidated=e=>{this.setState((t=>({...t,loginValidationResult:e})))};setLogin=e=>{this.setState((t=>({...t,login:e})));const{message:t,result:s}=R(e);this.setLoginValidated(s),s?this.setLoginError(""):this.setLoginError(t)};setLoginError=e=>{this.setState((t=>({...t,errorLogin:e})))};setPassword=e=>{if(this.setState((t=>({...t,password:e}))),this.state.password!=this.state.repeatPassword)return this.setRepeatPasswordError("Пароли не совпадают"),this.setPasswordError("Пароли не совпадают"),this.setPasswordValidated(!1),void this.setRepeatPasswordValidated(!1);const{message:t,result:s}=C(e);s?(this.setPasswordValidated(!0),this.setRepeatPasswordValidated(!0),this.setPasswordError(""),this.setRepeatPasswordError("")):(this.setPasswordValidated(!1),this.setPasswordError(t))};setPasswordError=e=>{this.setState((t=>({...t,errorPassword:e})))};setPasswordValidated=e=>{this.setState((t=>({...t,passwordValidationResult:e})))};setRepeatPassword=e=>{if(this.setState((t=>({...t,repeatPassword:e}))),this.state.password!=this.state.repeatPassword)return this.setRepeatPasswordError("Пароли не совпадают"),this.setPasswordError("Пароли не совпадают"),this.setPasswordValidated(!1),void this.setRepeatPasswordValidated(!1);const{message:t,result:s}=C(e);s?(this.setPasswordValidated(!0),this.setRepeatPasswordValidated(!0),this.setRepeatPasswordError(""),this.setPasswordError("")):(this.setRepeatPasswordValidated(!1),this.setRepeatPasswordError(t))};setRepeatPasswordError=e=>{this.setState((t=>({...t,errorRepeatPassword:e})))};setRepeatPasswordValidated=e=>{this.setState((t=>({...t,repeatPasswordValidationResult:e})))};render(){return o("form",{className:"register-form",children:[a("h3",{children:"Регистрация"}),a(k,{type:"text",placeholder:"Придумайте логин",icon:"/src/assets/user.png",onChange:this.setLogin,value:this.state.login,error:this.state.errorLogin,validationResult:this.state.loginValidationResult}),a(k,{type:"password",placeholder:"Придумайте пароль",icon:"src/assets/password.png",value:this.state.password,onChange:this.setPassword,error:this.state.errorPassword,validationResult:this.state.passwordValidationResult}),a(k,{type:"password",placeholder:"Повторите пароль",icon:"src/assets/password.png",value:this.state.repeatPassword,onChange:this.setRepeatPassword,error:this.state.errorRepeatPassword,validationResult:this.state.repeatPasswordValidationResult}),a(r,{label:"Войти",onClick:this.handleSubmit})]})}}class U extends t.Q.Component{state={selectedForm:"login",toggled:!1};componentDidMount(){this.setState((e=>({...e,selectedForm:window.location.pathname.replace("/","")}))),document.title="login"===this.state.selectedForm?"Вход":"Регистрация"}toggleForm=()=>{this.setState((e=>({selectedForm:"login"===e.selectedForm?"register":"login",toggled:!0}))),history.pushState(null,null,this.state.selectedForm),document.title="login"===this.state.selectedForm?"Вход":"Регистрация"};render(){return a("div",{className:"auth-page-wrapper "+(window.location.pathname.includes("login")?"login"===this.state.selectedForm?"":"active":this.state.toggled?"":"active"),children:a("div",{className:"glassmorphism-container",children:o("div",{className:"auth-container",children:[a("div",{className:"form-container sign-in",children:a(T,{})}),a("div",{className:"form-container sign-up"+(this.state.toggled?" fade-left":"")+(window.location.pathname.includes("login")&&this.state.toggled?" fade-right":""),children:a(A,{})}),a("div",{className:"toggle-container",children:o("div",{className:"toggle",children:[o("div",{className:"toggle-panel toggle-left",children:[a("h2",{children:"Уже есть аккаунт?"}),a(r,{label:"Войти",onClick:this.toggleForm})]}),o("div",{className:"toggle-panel toggle-right",children:[a("h2",{children:"Ещё нет аккаунта?"}),a(r,{label:"Зарегистрироваться",onClick:this.toggleForm})]})]})})]})})})}}class x extends t.Q.Component{state={id:0,title:"",content:"",update_time:""};componentDidMount(){this.setState((e=>{return{...e,id:this.props.note.id,title:this.props.note.data.title,content:(s=this.props.note.data.content,50,s.length>50?s.slice(0,49)+"...":s),update_time:(t=this.props.note.update_time,new Intl.DateTimeFormat("ru",{month:"short",day:"numeric",hour:"numeric",minute:"numeric",hourCycle:"h23"}).format(new Date(t)).replace(",",""))};var t,s}))}render(){return o("div",{className:"note-container "+(this.props.selected?"selected":""),id:this.state.id,children:[a("h3",{children:this.state.title}),a("p",{children:this.state.content}),a("span",{className:"update-time",children:this.state.update_time})]})}}class _ extends t.Q.Component{handleChange=e=>{this.props.onChange&&this.props.onChange(e.target.value)};render(){return o("div",{className:"search",children:[a("input",{type:"text",className:"search-input",placeholder:"Поиск...",oninput:this.handleChange}),a("img",{src:"/src/assets/search.svg",alt:"",className:"search-icon"})]})}}const L="SELECT_NOTE",D="SEARCH_NOTES",V="LOAD_NOTES",M="CLOSE_NOTE",F="EXIT_NOTES_PAGE",j="OPEN_DELETE_NOTE_DIALOG",W="CLOSE_DELETE_NOTE_DIALOG",G="DELETE_NOTE",Q="SAVE_NOTE",I="CREATE_EMPTY_NOTE",q=new class extends g{state={notes:[],selectedNote:void 0,query:"",offset:0,count:10,modalOpen:!1,saving:void 0};constructor(){super(),this.registerEvents()}registerEvents(){n.register((async e=>{switch(e.type){case L:await this.selectNote(e.payload);break;case M:this.closeNote();break;case D:await this.searchNotes(e.payload);break;case V:await this.loadNotes();break;case F:this.exit();break;case j:this.openModal();break;case W:this.closeModal();break;case G:await this.deleteNote();break;case Q:await this.saveNote(e.payload);break;case I:await this.createEmptyNote()}}))}openModal(){this.SetState((e=>({...e,modalOpen:!0})))}closeModal(){this.SetState((e=>({...e,modalOpen:!1})))}exit(){this.SetState((e=>({...e,query:"",offset:0,selectedNote:void 0,notes:[]})))}closeNote(){this.SetState((e=>({...e,selectedNote:void 0})))}async selectNote(e){const t=await u.Get(e,b.state.JWT);this.SetState((e=>({...e,selectedNote:t})))}async init(){return await this.fetchNotes(),this.state}async searchNotes(e){this.SetState((t=>({...t,offset:0,query:e}))),await this.fetchNotes(!0)}async loadNotes(){this.SetState((e=>({...e,offset:e.offset+e.count}))),await this.fetchNotes()}async fetchNotes(e=!1){const t={title:this.state.query,offset:this.state.offset,count:this.state.count},s=await u.GetAll(b.state.JWT,t);this.SetState((t=>({...t,notes:e?s:t.notes.concat(s)})))}async deleteNote(){204==await u.Delete(this.state.selectedNote.id,b.state.JWT)&&(this.SetState((e=>({...e,notes:e.notes.filter((e=>e.id!==this.state.selectedNote.id))}))),this.closeNote())}async saveNote(e){if(this.state.selectedNote.id==e.id){this.SetState((e=>({...e,saving:!0})));const t=await u.Update(e,b.state.JWT);console.log(t),S.success("Заметка успешно сохранена"),this.SetState((e=>({...e,saving:!1})))}}async createEmptyNote(){const e=await u.Add(b.state.JWT);this.SetState((t=>({...t,notes:[e,...t.notes]}))),console.log(this.state.notes)}};class z extends t.Q.Component{state={open:!1,selectedNote:void 0,saving:void 0,content:void 0};componentDidMount(){q.SubscribeToStore(this.updateState),document.querySelector(".note-editor").addEventListener("input",function(e,t){let s;return function(){clearTimeout(s),s=setTimeout((()=>e.apply(this)),1e3)}}(this.handleKeypress))}handleKeypress=()=>{this.state.selectedNote&&this.saveNote()};saveNote=()=>{const e=document.querySelector(".note-title"),t=document.querySelector(".note-content > span"),s={id:this.state.selectedNote.id,title:e.innerText,content:t.innerText};s.title===this.state.selectedNote.data.title&&s.content===this.state.selectedNote.data.content||n.dispatch(Q,s),this.setState((e=>({...e,selectedNote:{id:e.selectedNote.id,data:{title:s.title,content:s.content},update_time:e.selectedNote.update_time}})))};closeEditor=()=>{this.saveNote(),n.dispatch(M)};updateState=e=>{console.log("updateState"),console.log("2342342342342asdf"),console.log(this.state.selectedNote),this.setState((t=>({...t,selectedNote:e.selectedNote,open:void 0!==e.selectedNote,saving:e.saving}))),console.log(this.state.selectedNote)};deleteNote=()=>{n.dispatch(j)};render(){return o("div",{className:"note-editor "+(this.state.open?"active":""),children:[o("div",{className:"top-panel",children:[a("div",{className:"left-container"}),o("div",{className:"right-container",children:[a(w,{src:"/src/assets/trash.svg",className:"icon",onClick:this.deleteNote}),a(w,{src:"/src/assets/close.svg",className:"icon",onClick:this.closeEditor})]})]}),o("div",{className:"bottom-panel",children:[a("div",{className:"note-title-container",contentEditable:"true",children:a("h3",{className:"note-title",children:this.state.selectedNote?.data.title})}),a("div",{className:"note-content",contentEditable:"true",children:a("span",{children:this.state.selectedNote?.data.content})}),a("div",{className:"note-save-indicator",children:!1===this.state.saving?a("h3",{children:"Сохранено"}):""})]})]})}}class H extends t.Q.Component{state={open:!1};componentDidMount(){q.SubscribeToStore(this.updateState),document.addEventListener("click",this.handleClickOutside,!0)}handleClickOutside=e=>{e.target.classList.contains("overlay")&&n.dispatch(W)};componentWillUnmount(){q.UnSubscribeToStore(this.updateState),document.removeEventListener("click",this.handleClickOutside,!0)}updateState=e=>{this.setState((t=>({...t,open:e.modalOpen})))};closeModal=()=>{n.dispatch(W)};deleteNote=()=>{n.dispatch(G),n.dispatch(W)};render(){return o("div",{className:"modal-wrapper "+(this.state.open?"active":""),children:[a("div",{className:"overlay"}),o("div",{className:"modal-content",children:[a("h2",{children:"Удалить заметку?"}),a("span",{children:"Заметка и данные в ней будут удалены без возможности восстановления"}),o("div",{className:"buttons-container",children:[a(r,{label:"Удалить",onClick:this.deleteNote}),a(r,{label:"Отменить",className:"cancel-btn",onClick:this.closeModal})]}),a(w,{src:"/src/assets/close.svg",className:"close-modal-btn",onClick:this.closeModal})]})]})}}class J extends t.Q.Component{state={notes:[],selectedNote:void 0};componentDidMount(){document.title="Заметки",q.SubscribeToStore(this.updateState),this.setState((e=>({...e,notes:this.props.notes}))),this.createObserver()}componentWillUnmount(){n.dispatch(F),q.UnSubscribeToStore(this.updateState)}updateState=e=>{console.log("updateState"),console.log(this.state.notes),this.setState((t=>(t.notes.length>0&&t.notes.length<q.state.notes.length&&this.createObserver(),{...t,selectedNote:e.selectedNote,notes:e.notes}))),console.log(this.state.notes)};handleSelectNote=e=>{let t;e.target.matches(".note-container")?t=e.target.id:e.target.matches(".note-container *")&&(t=e.target.parentNode.id),console.log("handleSelectNote"),console.log(t),t&&n.dispatch(L,t)};createObserver(){new IntersectionObserver((function(e,t){e.forEach((e=>{e.isIntersecting&&(n.dispatch(V),t.unobserve(e.target))}))})).observe(document.querySelector(".note-container:last-child"))}searchNotes=e=>{n.dispatch(D,e)};createEmptyNote=()=>{console.log("createEmptyNote"),n.dispatch(I)};render(){return o("div",{className:"notes-page-wrapper "+(this.state.selectedNote?"active":""),children:[o("aside",{children:[a(H,{}),o("div",{className:"top-panel",children:[a(r,{label:"Новая заметка",onClick:this.createEmptyNote}),a(_,{onChange:this.searchNotes})]}),a("div",{className:"notes-container",onclick:this.handleSelectNote,children:this.state.notes.map((e=>a(x,{key1:e.id,note:e,selected:this.state.selectedNote?.id==e.id})))})]}),a(z,{})]})}}class K extends t.Q.Component{handleClick(){ne.go("/")}render(){return a("div",{className:"logo-wrapper",onclick:this.handleClick,children:a("img",{src:"src/assets/logo.png",alt:""})})}}class Y extends t.Q.Component{state={password:"",errorPassword:"",passwordValidationResult:!1,repeatPassword:"",errorRepeatPassword:"",repeatPasswordValidationResult:!1,open:!1};componentDidMount(){b.SubscribeToStore(this.updateState),document.addEventListener("click",this.handleClickOutside,!0)}componentWillUnmount(){b.UnSubscribeToStore(this.updateState),document.removeEventListener("click",this.handleClickOutside,!0)}handleClickOutside=e=>{e.target.classList.contains("overlay")&&this.closeModal()};updateState=e=>{this.setState((t=>({...t,open:e.updatePasswordFormOpen}))),this.state.open||setTimeout((()=>{this.setState((()=>({password:"",errorPassword:"",passwordValidationResult:!1,repeatPassword:"",errorRepeatPassword:"",repeatPasswordValidationResult:!1})))}),500)};closeModal=()=>{n.dispatch(P.CLOSE_CHANGE_PASSWORD_FORM)};setPassword=e=>{this.setState((t=>({...t,password:e}))),this.checkPassword(),this.checkRepeatPassword()};checkPassword=()=>{if(this.state.password.length>0&&this.state.password==this.state.repeatPassword)return this.setRepeatPasswordError("Пароли совпадают"),this.setPasswordError("Пароли совпадают"),this.setPasswordValidated(!1),void this.setRepeatPasswordValidated(!1);const{message:e,result:t}=C(this.state.password);t?(this.setPasswordValidated(!0),this.setPasswordError("")):(this.setPasswordValidated(!1),this.setPasswordError(e))};setPasswordError=e=>{this.setState((t=>({...t,errorPassword:e})))};setPasswordValidated=e=>{this.setState((t=>({...t,passwordValidationResult:e})))};setRepeatPassword=e=>{this.setState((t=>({...t,repeatPassword:e}))),this.checkPassword(),this.checkRepeatPassword()};checkRepeatPassword=()=>{if(this.state.repeatPassword.length>0&&this.state.password==this.state.repeatPassword)return this.setRepeatPasswordError("Пароли совпадают"),this.setPasswordError("Пароли совпадают"),this.setPasswordValidated(!1),void this.setRepeatPasswordValidated(!1);const{message:e,result:t}=C(this.state.repeatPassword);t?(this.setRepeatPasswordValidated(!0),this.setRepeatPasswordError("")):(this.setRepeatPasswordValidated(!1),this.setRepeatPasswordError(e))};setRepeatPasswordError=e=>{this.setState((t=>({...t,errorRepeatPassword:e})))};setRepeatPasswordValidated=e=>{this.setState((t=>({...t,repeatPasswordValidationResult:e})))};handleSubmit=()=>{this.checkPassword(),this.checkRepeatPassword(),this.state.passwordValidationResult&&this.state.repeatPasswordValidationResult&&n.dispatch(P.UPDATE_PASSWORD,{oldPassword:this.state.password,newPassword:this.state.repeatPassword})};render(){return o("div",{className:"modal-wrapper "+(this.state.open?"active":""),children:[a("div",{className:"overlay"}),o("div",{className:"modal-content change-password-form",children:[a("h2",{children:"Форма изменения пароля"}),a(k,{type:"password",placeholder:"Старый пароль",icon:"src/assets/password.png",value:this.state.password,onChange:this.setPassword,error:this.state.errorPassword,validationResult:this.state.passwordValidationResult}),a(k,{type:"password",placeholder:"Новый пароль",icon:"src/assets/password.png",value:this.state.repeatPassword,onChange:this.setRepeatPassword,error:this.state.errorRepeatPassword,validationResult:this.state.repeatPasswordValidationResult}),a(r,{label:"Изменить",onClick:this.handleSubmit}),a(w,{src:"/src/assets/close.svg",className:"close-modal-btn",onClick:this.closeModal})]})]})}}class $ extends t.Q.Component{state={open:!1,inUpload:!1};componentDidMount(){document.addEventListener("click",this.handleClickOutside,!0)}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside,!0)}handleClickOutside=e=>{document.querySelector(".toast")?.contains(e.target)||document.querySelector(".toggle-profile-button")?.contains(e.target)||document.querySelector(".popup-content")?.contains(e.target)||document.querySelector(".modal-wrapper")?.contains(e.target)||this.close()};close=()=>{this.setState((e=>({...e,open:!1})))};toggleOpen=()=>{this.setState((e=>({...e,open:!e.open})))};handleLogout=async()=>{n.dispatch(P.LOGOUT)};handlePhotoUpload=e=>{const t=e.target.files[0];if(t.size>2097152)return S.error("Фото слишком большое"),console.log(e.target),void(e.target.value=null);this.setState((e=>({...e,inUpload:!0}))),n.dispatch(P.UPDATE_AVATAR,t),setTimeout((()=>{this.setState((e=>({...e,inUpload:!1}))),e.target.value=null}),3e3)};openModal=()=>{n.dispatch(P.OPEN_CHANGE_PASSWORD_FORM)};render(){return o("div",{className:"user-profile-wrapper "+(this.state.open?"open":""),children:[o("div",{className:"toggle-profile-button",onclick:this.toggleOpen,children:[a("div",{className:"slider one"}),a("div",{className:"slider two"}),a("div",{className:"slider three"})]}),a("div",{className:"panel",children:o("div",{className:"popup-content",children:[o("div",{className:"user-avatar-container",children:[a(w,{src:"https://you-note.ru/images/"+this.props.avatarUrl,className:"user-avatar "+(this.state.inUpload?"loading":"")}),o("form",{className:"upload-preview",children:[a("input",{type:"file",accept:".jpg,.png",id:"upload-image-input",hidden:"true",onchange:this.handlePhotoUpload}),a("label",{htmlFor:"upload-image-input"}),a(w,{src:"src/assets/photo.svg",className:"upload-preview-icon"})]}),o("div",{className:"progress-wrapper "+(this.state.inUpload?"active":""),children:[a("div",{className:"inner"}),o("div",{className:"checkmark",children:[a("span",{}),a("span",{})]}),o("div",{className:"circle",children:[a("div",{className:"bar left",children:a("div",{className:"progress"})}),a("div",{className:"bar right",children:a("div",{className:"progress"})})]})]})]}),a("span",{className:"username",children:b.state.username}),a("span",{className:"change-password-btn",onclick:this.openModal,children:"Изменить пароль"}),a(r,{label:"Выйти",className:"logout-btn",onClick:this.handleLogout})]})}),a(Y,{})]})}}class B extends t.Q.Component{state={isAuth:!1,userChecked:!1,avatarUrl:!1};componentDidMount(){b.SubscribeToStore(this.updateState),n.dispatch(P.CHECK_USER)}updateState=e=>{this.setState((t=>({...t,isAuth:e.isAuth,avatarUrl:e.avatarUrl,userChecked:!0})))};render(){return o("header",{id:"header",children:[a(K,{}),this.state.userChecked?this.state.isAuth?a($,{avatarUrl:this.state.avatarUrl}):this.props.currPage!==U?a(r,{label:"Вход",onClick:()=>ne.go("/login")}):"":""]})}}class X extends t.Q.Component{render(){return o("div",{className:"background",children:[a("div",{className:"parallax-bg"}),a("div",{id:"stars"}),a("div",{id:"stars2"}),a("div",{id:"stars3"})]})}}class Z extends t.Q.Component{render(){return a("div",{className:"notes-page-skeleton-wrapper",children:o("aside",{children:[a("div",{className:"search-bar-skeleton"}),o("div",{className:"notes-container-skeleton",children:[a("div",{className:"note-skeleton"}),a("div",{className:"note-skeleton"}),a("div",{className:"note-skeleton"}),a("div",{className:"note-skeleton"})]})]})})}}var ee=Z;class te extends t.Q.Component{render(){return a("div",{className:"auth-page-skeleton-wrapper",children:a("div",{className:"auth-form-container-skeleton",children:a("div",{className:"auth-form-skeleton"})})})}}var se=te;const ae=async()=>{const e=new Promise(((e,t)=>{let s;const a=o=>{s=o.isAuth,b.UnSubscribeToStore(a),s?(ne.go("/"),t()):e(null)};b.SubscribeToStore(a),n.dispatch(P.CHECK_USER)}));return await e},oe=async()=>{const e=new Promise(((e,t)=>{let s;const a=o=>{s=o.isAuth,b.UnSubscribeToStore(a),s?q.init().then((t=>{e({notes:t.notes})})):(ne.go("/"),t())};b.SubscribeToStore(a),n.dispatch(P.CHECK_USER)}));return await e};class re extends t.Q.Component{state={currPage:N,PageProps:{}};constructor(){super(),ne=this,this.pages=new Map,this.initPages()}componentDidMount(){const e=window.location.pathname;window.addEventListener("popstate",(()=>{this.go(window.location.pathname)})),this.go(e)}initPages=()=>{this.pages["/"]={page:N,pageProps:{}},this.pages["/login"]={page:U,loader:ae,skeleton:se},this.pages["/register"]={page:U,loader:ae,skeleton:se},this.pages["/notes"]={page:J,loader:oe,skeleton:ee}};go(e){const t=this.pages[e];history.pushState({path:e},"",e),void 0!==t?void 0!==t.loader?(this.setState((e=>({...e,currPage:t.skeleton}))),t.loader().then((e=>{this.setState((s=>({...s,currPage:t.page,PageProps:e})))})).catch((()=>{}))):this.setState((e=>({...e,currPage:t.page}))):this.setState((e=>({...e,currPage:E,PageProps:{err:"404 NotFound"}})))}render(){return o("div",{children:[a(y,{}),a(B,{currPage:this.state.currPage}),t.Q.createComponent(this.state.currPage,{...this.state.PageProps,key:this.state.currPage.name}),this.state.currPage!==J&&this.state.currPage!==ee?a(X,{currPage:this.state.currPage}):""]})}}let ne;class ie extends t.Q.Component{render(){return a(re,{})}}(0,e.renderDOM)("root",t.Q.createComponent(ie,{}))}()}();